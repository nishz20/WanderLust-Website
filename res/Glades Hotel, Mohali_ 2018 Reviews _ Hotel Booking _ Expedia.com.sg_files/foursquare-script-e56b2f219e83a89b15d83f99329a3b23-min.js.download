define("mapsInfoCard",["marionette"],function(f){return f.ItemView.extend({template:"maps-info-card",onRender:function(){var b=this.el.querySelector("#mapRestaurantRating");if(b){var g=this.getClassForRating(this.model.get("rating"));g?b.classList.add(g):b.className="none"}},getClassForRating:function(b){if(9<=b)b="rating_color_9";else if(8<=b)b="rating_color_8";else if(7<=b)b="rating_color_7";else if(6<=b)b="rating_color_6";else if(0<=b)b="rating_color_less_5";else return;return b}})});define("bumiServiceUtil",["jquery","logger","mapConfig"],function(f,b,g){function a(a,k){return f.ajax({type:"GET",url:g.config.bumiFourSquarePath+"/"+a+"/"+k+"/",headers:{"Client-Token":"LODGING-PWA"},tryCount:0,retryLimit:3,timeout:5E3,success:function(a){return a},error:function(a,d){b.logError("[BUMI_SERVICE_ERROR] Failed or invalid response",Error(d+"|status\x3d"+a.status+"|responseText\x3d"+a.responseText));"timeout"==d&&(this.tryCount++,this.tryCount<=this.retryLimit&&f.ajax(this))}})}return{richDataFromBumiFourSquare:function(d,b){var e=f.Deferred();a(d,b).then(function(a){e.resolve(a)}).fail(function(){e.reject()});return e.promise()}}});define("exp15478","underscore jquery backbone infosite uitk bumiServiceUtil dctk mapsInfoCard".split(" "),function(f,b,g,a,d,k,e,m){function c(){if(!document.getElementById("foursquareToggleButtonContainer")){var a=document.getElementsByClassName("map-canvas"),c=document.createElement("div");c.setAttribute("id","foursquareToggleButtonContainer");var n=document.createElement("fieldset");n.setAttribute("id","foursquare-fieldset");n.setAttribute("class","on-off-switch checkbox");var b=document.createElement("label");b.setAttribute("id","foursquare-check");b.setAttribute("class","check");b.setAttribute("for","foursquare-checkbox");var d=document.createElement("input");d.setAttribute("type","checkbox");d.setAttribute("id","foursquare-checkbox");d.setAttribute("name","foursquare-toggle-button");d.setAttribute("value","checked");d.setAttribute("class","masked visuallyhidden");var e=document.createElement("span");e.setAttribute("class","inline-label");var g=document.createTextNode("RESTAURANTS"),f=document.createElement("div");f.setAttribute("id","foursquare-label-and-logo-outer-container");var m=document.createElement("div");m.setAttribute("id","foursquare-label-and-logo-inner-container");var h=document.createElement("div");h.setAttribute("id","foursquare-label-and-logo-container-text");var k=document.createElement("img");k.setAttribute("id","foursquare-logo");k.setAttribute("src","/static/default/default/images/infosite/maps/Powered-by-Foursquare-full-color.png");var l=document.createTextNode("RESTAURANTS");h.appendChild(l);m.appendChild(h);m.appendChild(k);f.appendChild(m);e.appendChild(g);c.appendChild(n);n.appendChild(b);n.appendChild(f);b.appendChild(d);b.appendChild(e);a.item(0).appendChild(c)}}function p(a){c();!q&&a&&(q=!0,d.subscribe("onOffSwitch.changed",function(a,c){c.context.hasAttribute("checked")?(window.uitk.mapObj.selectedMarker&&l(),r(!1),e.trackEvent({name:"AB-15478 HIS_HotelCA_SmokeTest_FourSquare_API",rfrr:"HOT.HIS.Map.FoursquareRestaurant.No"})):(r(!0),e.trackEvent({name:"AB-15478 HIS_HotelCA_SmokeTest_FourSquare_API",rfrr:"HOT.HIS.Map.FoursquareRestaurant.Yes"}))}))}function y(a){window.uitk.map.data["hotel-map"].module.infowindow.close();var c=document.getElementById("foursquareInfoWindow");if(a&&a.restaurantData&&a.restaurantData.venue){var b=a.restaurantData.venue;a=g.Model;var d=t(b)+"255x144"+u(b),x=t(b)+"96x138"+u(b),e=b.name,f=b.rating&&0!==b.rating?b.rating:null,h=b.categories&&b.categories[0]&&b.categories[0].shortName?b.categories[0].shortName:"";if(b.price&&b.price.currency&&b.price.tier){for(var k=0,l="";b.price.tier>k;)l+=b.price.currency,k++;b=l}else b="";a=new a({thumbnailURLDesktop:d,thumbnailURLMobile:x,name:e,rating:f,type:h,priceTier:b});c.innerHTML=(new m({model:a})).render().el.innerHTML}}function z(){document.getElementById("foursquareInfoWindow").addEventListener("click",function(){e.trackEvent({name:"AB-15478 HIS_HotelCA_SmokeTest_FourSquare_API",rfrr:"HOT.HIS.Map.FoursquareRestaurant.Info.Click"})})}function t(a){return a&&a.featuredPhotos&&a.featuredPhotos.items[0]&&a.featuredPhotos.items[0].prefix?a.featuredPhotos.items[0].prefix:""}function u(a){return a&&a.featuredPhotos&&a.featuredPhotos.items[0]&&a.featuredPhotos.items[0].suffix?a.featuredPhotos.items[0].suffix:""}function A(){b.each(h,function(a,c){window.google.maps.event.addListener(c,"click",function(){!1===c.selected&&(window.uitk.mapObj.selectedMarker&&null!==window.uitk.mapObj.selectedMarker&&l(),window.uitk.mapObj.selectedMarker=c,c.originalZIndex=c.zIndex,c.setZIndex(window.google.maps.Marker.MAX_ZINDEX),c.selected=!0,e.trackEvent({name:"AB-15478 HIS_HotelCA_SmokeTest_FourSquare_API",rfrr:"HOT.HIS.Map.FoursquareRestaurant.POISelect"}),b.each(h,function(b,c){b!==a&&c.setIcon({url:"/static/default/default/images/infosite/maps/marker-restaurant.png"})}),c.setIcon({url:"/static/default/default/images/infosite/maps/marker-restaurant-selected.png"}),y(c))})})}function B(){h=[];f.each(v,function(a){if(a.venue.name&&""!==a.venue.name){var b=new window.google.maps.LatLng(a.venue.location.lat,a.venue.location.lng);a=new window.google.maps.Marker({position:b,map:w,icon:{url:"/static/default/default/images/infosite/maps/marker-restaurant.png"},visible:!1,restaurantData:a,selected:!1});h.push(a)}});A()}function r(a){for(var b=0;b<h.length;b++)h[b].setVisible(a)}function l(){window.uitk.mapObj.selectedMarker.setIcon({url:"/static/default/default/images/infosite/maps/marker-restaurant.png"});document.getElementById("foursquareInfoWindow").innerHTML="";window.uitk.mapObj.selectedMarker.setZIndex(window.uitk.mapObj.selectedMarker.originalZIndex);window.uitk.mapObj.selectedMarker.selected=!1;window.uitk.mapObj.selectedMarker=null}function C(){window.google.maps.event.addListener(window.uitk.mapObj,"click",function(){window.uitk.mapObj.selectedMarker&&l()})}var q=!1,v,h=[],w;return{run:function(){d.subscribe("map.appended",function(){var b=document.getElementsByClassName("map-canvas"),c=document.createElement("div");c.setAttribute("id","foursquareInfoWindow");b[0].appendChild(c);a.evaluateExperimentAndLog(15478,function(a){if(1===a){z();window.uitk.mapObj.setOptions({zoomControlOptions:{position:window.google.maps.ControlPosition.TOP_RIGHT}});window.uitk.mapObj.setOptions({streetViewControlOptions:{position:window.google.maps.ControlPosition.RIGHT_TOP}});window.uitk.mapObj.setOptions({mapTypeControlOptions:{position:window.google.maps.ControlPosition.RIGHT_BOTTOM}});window.uitk.mapObj.setOptions({fullscreenControl:!1});C();window.uitk.map.data["hotel-map"].module.markers&&window.uitk.map.data["hotel-map"].module.markers.map(function(a){window.google.maps.event.addListener(a,"click",function(){l()})});w=d.map.data["hotel-map"].module.map;var b=d.map.data["hotel-map"].module.markers[0];a=b.getPosition().lat();b=b.getPosition().lng();k.richDataFromBumiFourSquare(a,b).then(function(a){v=a;B();p(!0)}).fail(function(){p(!1)})}})})}}});
require(["handlebars"],function(f){var b=f.template({1:function(b,a,d,f,e){var g;return'            \x3cdiv id\x3d"mapRestaurantRating" class\x3d"rating"\x3e'+b.escapeExpression((g=null!=(g=d.rating||(null!=a?a.rating:a))?g:d.helperMissing,"function"===typeof g?g.call(null!=a?a:{},{name:"rating",hash:{},data:e}):g))+"/10\x3c/div\x3e\n"},compiler:[7,"\x3e\x3d 4.0.0"],main:function(b,a,d,f,e){var g,c;return'\x3cdiv id\x3d"mapRestaurantInfoCard"\x3e\n    \x3cimg class\x3d"mapImgDesktop" src\x3d"'+b.escapeExpression((c=null!=(c=d.thumbnailURLDesktop||(null!=a?a.thumbnailURLDesktop:a))?c:d.helperMissing,"function"===typeof c?c.call(null!=a?a:{},{name:"thumbnailURLDesktop",hash:{},data:e}):c))+'"/\x3e\n    \x3cimg class\x3d"mapImgMobile" src\x3d"'+b.escapeExpression((c=null!=(c=d.thumbnailURLMobile||(null!=a?a.thumbnailURLMobile:a))?c:d.helperMissing,"function"===typeof c?c.call(null!=a?a:{},{name:"thumbnailURLMobile",hash:{},data:e}):c))+'"/\x3e\n    \x3cdiv id\x3d"content"\x3e\n        \x3cdiv class\x3d"name"\x3e'+b.escapeExpression((c=null!=(c=d.name||(null!=a?a.name:a))?c:d.helperMissing,"function"===typeof c?c.call(null!=a?a:{},{name:"name",hash:{},data:e}):c))+'\x3c/div\x3e\n        \x3cdiv class\x3d"detailInfo"\x3e\n'+(null!=(g=d["if"].call(null!=a?a:{},null!=a?a.rating:a,{name:"if",hash:{},fn:b.program(1,e,0),inverse:b.noop,data:e}))?g:"")+'            \x3cdiv class\x3d"type"\x3e'+b.escapeExpression((c=null!=(c=d.type||(null!=a?a.type:a))?c:d.helperMissing,"function"===typeof c?c.call(null!=a?a:{},{name:"type",hash:{},data:e}):c))+'\x3c/div\x3e\n            \x3cdiv class\x3d"priceTier"\x3e'+b.escapeExpression((c=null!=(c=d.priceTier||(null!=a?a.priceTier:a))?c:d.helperMissing,"function"===typeof c?c.call(null!=a?a:{},{name:"priceTier",hash:{},data:e}):c))+'\x3c/div\x3e\n        \x3c/div\x3e\n    \x3c/div\x3e\n    \x3cimg class\x3d"logo" src\x3d"/static/default/default/images/infosite/maps/Powered-by-Foursquare-full-color.png"/\x3e\n\x3c/div\x3e\n'},useData:!0});f.templates=f.templates||{};f.templates["maps-info-card"]=b;f.partials=f.partials||{};f.partials["maps-info-card"]=b});
//# sourceMappingURL=foursquare-script.js.map